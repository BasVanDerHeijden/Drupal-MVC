<?php
class View extends StdClass{
  /**
   * Current template file
   * @var string
   */
  protected $_template;
  
  /**
   * The contents of the view object
   * @var object
   */
  public $content;

  public function __call($key,$params){
    if(!isset($this->{$key})) throw new MVCException("Call to undefined method ".get_class($this)."::".$key."()");
    $subject = $this->{$key};
    call_user_func_array($subject,$params);
  }
    
  public function __construct($template = null) {
    if ($template !== null) {
      $this->setTemplate($template);
    }
  }
  
  /**
   * Set the template
   * @param string $template
   * @throws MVCException 
   */
  public function setTemplate($template) {
    if (!file_exists($template)) {
      throw new MVCException('The specified template does not exist.');
    }
    $this->_template = $template;
  }

  /**
   * Returns the current template
   * @return string 
   */
  public function getTemplate() {
    return $this->_template;
  }

  /**
   * Return the rendered view
   * @param boolean $returnString
   * @return array content
   */
  public function render($returnString = false) {
    if ($this->_template !== '') {
      ob_start();
      include($this->_template);
      $this->content = ob_get_clean();
      
      if($returnString){
        return $this->content;
      }
      
      return array('view'=>$this->content);
    }
    else{
       return array('view'=>$this->toArray());
    }
  }
  
  public function __toString(){
    return $this->render();
  }

  public function toArray(){
    return (array)$this;
  }
}
