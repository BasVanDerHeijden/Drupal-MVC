<?php
class KlachtForm extends Form {
  public function __construct($post = array()) {
    $fields = array();
    
    $fields['title'] = array(
      '#type' => 'textfield',
      '#title' => 'Titel',
      '#default_value' => '',
    );
    $fields['body'] = array(
      '#type' => 'textarea',
      '#title' => 'Inhoud',
    );
    $fields['submit'] = array(
      '#type' => 'submit',
      '#value' => 'Nieuwe klacht indienen',
    );
    
    $this->addFields($fields);
    
    parent::__construct($post);
  }
  
  
  public function validate() {
    if (!$this->data) {
      $this->data['body']->setError('No post data given for form: '.__CLASS__);
    }
    
    if (strlen((string) $this->data['title']) > 2) {
      $this->data['title']->setError('Uw titel mag maximaal 2 karakters bevatten. Weinig he?');
    }
    else {
      $this->validated = TRUE;
    }
  }
  
  public function submit() {
    $this->Complaint = new ComplaintModel();
    $this->Complaint->load(Model::NEW_INSTANCE);

    $this->Complaint->title->set((string) $this->data['title']);
    $this->Complaint->body->value->set((string) $this->data['body']);
    
    $this->Complaint->save();
    
    drupal_set_message('Bedankt voor het posten!');
    drupal_goto($this->Complaint->getUri());
  }
}